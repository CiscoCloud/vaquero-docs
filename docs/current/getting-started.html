<head>
            
<meta charset="UTF-8"> <!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge"><![endif]--> <meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>
Vaquero Getting Started
</title>
            
<link rel="stylesheet" type="text/css" href="../doc.css"> <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400"> <link rel='shortcut icon' href='cow.png' type='image/x-icon'/ >
<style>
                .markdown-body {
                    box-sizing: border-box;
                    min-width: 200px;
                    max-width: 1200px;
                    margin: 0 auto;
                    padding: 45px;
                }
            </style>
</head><article class="markdown-body">

<h1 id="getting-started">getting started</h1>
<p><a href="https://ciscocloud.github.io/vaquero-docs/">Home</a> | <a href="https://github.com/CiscoCloud/vaquero-docs/tree/master">Docs Repo</a></p>
<h2 id="table-of-contents">Table of Contents</h2>
<ol style="list-style-type: decimal">
<li><p><a href="#basic-vaquero-deployment">basic vaquero deployment</a> A. <a href="#single-node">Virtual environment - standalone model (Single node)</a> B. <a href="#multiple-nodes">Virtual environment - server/agent model (Multiple nodes)</a></p></li>
<li><p><a href="#etcd-and-vaquero">etcd and vaquero</a></p></li>
<li><p><a href="#ipmi-reboots">simulating IPMI reboots in the virtual environment</a></p></li>
<li><p><a href="#vaquero-demo-lab">vaquero demo lab</a> A. <a href="#virtual-env-layout">virtual env layout</a> B. <a href="#canned-demos">canned demos</a> C. <a href="#sandbox-mac-space">using the sandbox mac space</a> D. <a href="tools.html">running the validator OR preview</a> E. <a href="#kubernetes-in-the-virtualenv">kubernetes in the Virtualenv</a></p></li>
</ol>
<h1 id="basic-vaquero-deployment">1. <a name="basic-vaquero-deployment">basic vaquero deployment</a></h1>
<h2 id="virtual-environment"><a href="https://github.com/CiscoCloud/vaquero-vagrant">virtual environment</a></h2>
<p>Repo for deploying vaquero via vagrant on VirtualBox VMs. Validated on OSX and Windows. Base VM image is Centos7 with docker, kernels and initrds pre-installed.</p>
<p>Vaquero can run in standalone or in separate server/agent modes. &quot;Standalone&quot; refers to both the agent and server running out of the same container, and is intended for use in testing and in POCs. Production deployments should have multiple (separate) servers and agents. [As of early November 2016, HA servers are in progress.]</p>
<h2 id="a.-standalone-model-single-node">A. <a name="single-node">standalone model (Single node)</h2>
<h3 id="clone-the-vagrant-repo">1. clone the vagrant repo</h3>
<p><code>git clone https://github.com/CiscoCloud/vaquero-vagrant.git &amp;&amp; cd vaquero-vagrant</code></p>
<h3 id="boot-vaquero-vm">2. boot vaquero VM</h3>
<p><code>vagrant up</code>: deploys one vaquero VM in standalone mode</p>
<p><strong>etcd check</strong> Once the VM is booted and before running vaquero, ssh into your server machine. <code>vagrant ssh vs-1</code></p>
<p><strong>Note:</strong> from this point on the following commands are being run on your server machine.</p>
<p>Perform a cluster health check: <code>ETCDCTL_API=2 etcdctl cluster-health</code>.</p>
<h3 id="start-docker-and-kubernetes">3. start docker and kubernetes</h3>
<p><code>sudo ./kube-start.sh</code></p>
<h3 id="pull-the-latest-docker-image">4. pull the latest docker image</h3>
<p><code>docker pull shippedrepos-docker-vaquero.bintray.io/vaquero/vaquero:latest</code></p>
<h3 id="run-vaquero-with-one-of-the-source-of-truth-sot-types">5. run vaquero with one of the source of truth (SoT) types</h3>
<p>There are two types of SoTs with which you can run Vaquero, either a git repository or local directory. Both contain the same kinds of information and are broken down into subdirectories; the only difference is where the SoT is stored:</p>
<ol style="list-style-type: decimal">
<li><strong>git SoT</strong>: a remote Git repository containing the required SoT files. <em>Note</em>: for this to work, you must add your personal git token into the <a href="https://github.com/CiscoCloud/vaquero-vagrant/tree/master/config">config</a></li>
<li><strong>dir SoT</strong>: a local directory containing the required SoT files. No additional overhead is needed for a local dir SoT.</li>
</ol>
<p>Both types of SoTs require specific folders, formatting and information. <a href="https://ciscocloud.github.io/vaquero-docs/docs/current/data-model-howto.html">See the Data Model How-To Page</a> for details.</p>
<p>For working examples of both kinds of SoT, see <a href="https://github.com/CiscoCloud/vaquero-vagrant/tree/master/config">configurations</a>.</p>
<p><strong>Note</strong>: We default DHCP to run in server mode. If you want to run vaquero in DHCP proxy mode, edit the configuration in <code>config/</code> and start the dnsmasq VM by running: <code>vagrant up dnsmasq</code>. This will stand up dnsmasq VM running a DHCP server that only serves IP addresses.</p>
<h5 id="git-sot">git SoT:</h5>
<p><code>docker run -v /vagrant/config/git-sot.yaml:/vaquero/config.yaml -v /var/vaquero/files:/var/vaquero/files -v /vagrant/provision_files/secret:/vaquero/secret --net=&quot;host&quot; -e VAQUERO_SHARED_SECRET=&quot;&lt;secret&gt;&quot; -e VAQUERO_SERVER_SECRET=&quot;&lt;secret&gt;&quot; -e VAQUERO_SITE_ID=&quot;test-site&quot; -e VAQUERO_AGENT_ID=&quot;test-agent&quot; shippedrepos-docker-vaquero.bintray.io/vaquero/vaquero:latest standalone --config /vaquero/config.yaml</code></p>
<h5 id="dir-sot">dir SoT:</h5>
<p><code>docker run -v /vagrant/config/dir-sot.yaml:/vaquero/config.yaml -v /var/vaquero/files:/var/vaquero/files -v /vagrant/local:/vagrant/local -v /vagrant/provision_files/secret:/vaquero/secret --net=&quot;host&quot; -e VAQUERO_SHARED_SECRET=&quot;&lt;secret&gt;&quot; -e VAQUERO_SERVER_SECRET=&quot;&lt;secret&gt;&quot; -e VAQUERO_SITE_ID=&quot;test-site&quot; -e VAQUERO_AGENT_ID=&quot;test-agent&quot; shippedrepos-docker-vaquero.bintray.io/vaquero/vaquero:latest standalone --config /vaquero/config.yaml</code></p>
<h2 id="b.-serveragent-model-multiple-nodes">B. <a name="multiple-nodes">server/agent model (Multiple nodes)</a></h2>
<h3 id="clone-the-vagrant-repo-1">1. clone the vagrant repo</h3>
<p><code>git clone https://github.com/CiscoCloud/vaquero-vagrant.git &amp;&amp; cd vaquero-vagrant</code></p>
<h3 id="boot-vaquero-vms">2. boot vaquero VMs</h3>
<h4 id="run-commands-with-environment-vars">Run Commands with Environment Vars</h4>
<p>Previously, in standalone mode, <code>vagrant up</code>: deployed one vaquero VM in standalone mode. This is equivalent to runing <code>VS_NUM=1 vagrant up</code>. By default, the only ENVIRONMENT variable set is <code>VS_NUM=1</code>.</p>
<p>To now move beyond that basic configuration, the types of servers must be specified:</p>
<ul>
<li><p><code>VA_NUM=1 vagrant up</code>: deploys one vaquero server and one vaquero agent.</p></li>
<li><p><code>VS_NUM=3 VA_NUM=3 V_RELAY=1 vagrant up</code>: deploys 3 vaquero servers and 3 vaquero agents with the relay.</p></li>
</ul>
<h5 id="warning-you-must-set-these-environment-variables-in-your-session-or-prepend-the-env-vars-to-every-vagrant-command."><em>WARNING</em>: You must set these environment variables in your session or prepend the ENV vars to every <code>vagrant</code> command.</h5>
<p>For example: <code>VS_NUM=3 vagrant up</code> will stand up 3 vaquero server VMs. Running <code>vagrant destroy -f</code> will only destroy the first instance, you must run <code>VS_NUM=3 vagrant destroy -f</code> to clean up all of them. Include <em>every</em> ENV var for <em>every</em> vagrant command, even things like <code>vagrant ssh vs-3</code>.</p>
<p>Lets look at the ENVIRONMENT variables that can be configured for the VM infrastructure:</p>
<ul>
<li><code>VS_NUM</code>: An integer number of how many vaquero server VMs to start. Default: 1 (this can be used for standalone mode)</li>
<li><code>VA_NUM</code>: An integer number of how many vaquero agent VMs to start</li>
<li><code>V_DEV</code>: A 0 or non-zero integer that will allocate more resources to the VM. By default we allocate 1 vCPU and 512MBs of RAM, enabling <code>V_DEV</code> allocates 2 vCPUs and 2048MBs of RAM. Vagrant will also attempt to sync the host <code>GOPATH</code> to <code>/home/vagrant/go</code></li>
<li><code>V_RELAY</code>: A 0 or non-zero integer that will set up vaquero to be deployed on a separate subnet from its booting hosts. It will also set up a dual homed <code>gateway</code> machine that will forward packets between the subnets. <em>The data model must be updated to reflect the new IPs / subnet. The fastest way to run with relay is using the local_dir and run the <code>provision_scripts/relay-setup.sh</code> script, run <code>/provision_scripts/relay-reset.sh</code> to bring the data model back to the start state. If you want to do it via github, you must make your own repo and update the server and agent IPs.</em></li>
</ul>
<p><strong>Etcd check:</strong> Once the VM(s) are booted and before running vaquero, ssh into one of your server machines. Perform a cluster health check: <code>ETCDCTL_API=2 etcdctl cluster-health</code>. If an error message appears, wait until all machines are live, then perform the cluster health check again.</p>
<h3 id="start-docker-and-kubernetes-1">3. start docker and kubernetes</h3>
<p><code>sudo ./kube-start.sh</code></p>
<h3 id="pull-the-latest-docker-image-1">4. pull the latest docker image</h3>
<p><code>docker pull shippedrepos-docker-vaquero.bintray.io/vaquero/vaquero:latest</code></p>
<h3 id="run-vaquero-with-one-of-the-source-of-truth-types">5. run vaquero with one of the source of truth types</h3>
<p>There are two types of SoTs with which you can run Vaquero. Both contain the same kinds of information and are broken down into subdirectories; the only difference is where the SoT is stored:</p>
<ol style="list-style-type: decimal">
<li><strong>git SoT</strong>: a remote Git repository containing the required SoT files. <em>Note</em>: for this to work, you must add your personal git token into the <a href="https://github.com/CiscoCloud/vaquero-vagrant/tree/master/config">config</a></li>
<li><strong>dir SoT</strong>: a local directory containing the required SoT files. No additional overhead is needed for a local dir SoT.</li>
</ol>
<p>Both types of SoTs require specific folders, formatting and information. <a href="https://ciscocloud.github.io/vaquero-docs/docs/current/data-model-howto.html">See the Data Model How-To Page</a> for details.</p>
<p>For working examples of both kinds of SoT, see <a href="https://github.com/CiscoCloud/vaquero-vagrant/tree/master/config">configurations</a>.</p>
<p><strong>Note</strong>: We default DHCP to run in server mode. If you want to run vaquero in DHCP proxy mode, edit the configuration in <code>config/</code> and start the dnsmasq VM by running: <code>vagrant up dnsmasq</code>. This will stand up dnsmasq VM running a DHCP server that only serves IP addresses.</p>
<h3 id="sot-for-separate-server-and-agent">SoT for separate server and agent</h3>
<ol style="list-style-type: decimal">
<li><p>Update data model to reflect VM IPs. Look at the site's <code>env.yml</code> and ensure the agent IP is correct. See the <em>vagrant VM table</em> below to see IPs for <code>vs</code> and <code>va</code> VMs</p></li>
<li><p>Ensure server configuration and agent configuration match the IPs of the VM's. We have provided two example configs for separate server and agent using the local dir SoT in the vagrant repo. <code>VS_NUM=1 VA_NUM=1</code></p></li>
<li><p>Run each container in their respective mode. <code>server</code> or <code>agent</code> instead of <code>standalone</code></p></li>
</ol>
<h5 id="separate-server-dir-sot">separate server dir SoT</h5>
<p><code>docker run -v /vagrant/config/dir-sot-server.yaml:/vaquero/config.yaml -v /var/vaquero/files:/var/vaquero/files -v /vagrant/local:/vagrant/local -v /vagrant/provision_files/secret:/vaquero/secret --net=&quot;host&quot; -e VAQUERO_SHARED_SECRET=&quot;&lt;secret&gt;&quot; -e VAQUERO_SERVER_SECRET=&quot;&lt;secret&gt;&quot;   shippedrepos-docker-vaquero.bintray.io/vaquero/vaquero:latest server --config /vaquero/config.yaml</code></p>
<h5 id="separate-agent-dir-sot">separate agent dir SoT</h5>
<p><code>docker run -v /vagrant/config/dir-sot-agent.yaml:/vaquero/config.yaml --net=&quot;host&quot; -e VAQUERO_SHARED_SECRET=&quot;&lt;secret&gt;&quot; -e VAQUERO_SITE_ID=&quot;test-site&quot; -e VAQUERO_AGENT_ID=&quot;test-agent&quot;  shippedrepos-docker-vaquero.bintray.io/vaquero/vaquero:latest agent --config /vaquero/config.yaml</code></p>
<h1 id="etcd-and-vaquero">2. <a name="etcd-and-vaquero">etcd and vaquero</a></h1>
<p><a href="https://coreos.com/etcd/">CoreOS Etcd</a> is a distributed, persistent key-value store. Vaquero users have the option to specify the use of an etcd cluster (vs. local filestorage) as Vaquero's internal storage. Vaquero will use that storage, in turn, to keep copies of SoTs, and to store internal information, such as tasks to be sent to Vaquero agents. Should the user elect to use their etcd cluster for Vaquero, it is up to them to maintain and secure the cluster; Vaquero simply reads and writes to the specified endpoints, and will not modify or add more nodes.</p>
<p>The vaquero vagrant VM (described above) has a running etcd cluster baked in. You can explore the <code>vaquero-vagrant</code> <code>provision-scripts</code> folder (<code>etcd-config.sh</code>, <code>etcd.sh</code>, and <code>etcd-start.sh</code>) to see how we install and start up etcd every time we boot a machine. The example below demonstrates how to configure vaquero to use etcd.</p>
<h2 id="how-to-run-vaquero-using-etcd">how to run vaquero using etcd</h2>
<h3 id="boot-vaquero-cluster">1. boot vaquero cluster</h3>
<p>Inside your host machine, in the <code>vaquero-vagrant</code> repo, run: <code>V_DEV=1 VS_NUM=3 vagrant up</code>. This will boot up a cluster of three vaquero servers, running on <code>10.10.10.5 - 10.10.10.7</code>. ### 2. Test your cluster <code>ssh</code> into two of the VMs: <code>V_DEV=1 VS_NUM=3 vagrant ssh vs-1</code> in one tab, <code>V_DEV=1 VS_NUM=3 vagrant ssh vs-2</code> in another. (<strong>Note:</strong> this example uses three Vaquero servers, but you can start any number of VS machines (even one!), as long as each machine is configured for Etcd.) a. enter data To test to make sure the cluster is running, put a key-value pair into <code>vs-1</code>:</p>
<pre><code>    [vagrant@vs-1 ~]$ etcdctl put hello world
    OK</code></pre>
<ol start="2" style="list-style-type: lower-alpha">
<li><p>retrieve data In <code>vs-2</code>, try to fetch that key: <code>etcdctl get hello</code>.</p>
<pre><code>[vagrant@vs-2 ~]$ etcdctl get hello
hello
world</code></pre></li>
</ol>
<p><em>If you receive an empty output pair, or a grpc-related dialing issue on PUT, ensure that all three machines have booted before you continue. If you continue to have a problem, reboot each of the VMs, and then force-start Etcd: <code>sudo systemctl start etcd</code>. Check the cluster-health (<code>etcdCTL_API=2 etcdctl cluster-health</code>), then try to repeat steps 3-4.</em></p>
<h3 id="c.-check-config">c. Check config</h3>
<p>Now that we've seen Etcd working on our vaquero server cluster, open up any server config (I used <code>/vagrant/config/dir-sot.yaml</code>). If you use <code>dir-sot.yaml</code>, you'll see that Etcd information is already specified (replicated below). Note that the endpoints are the <strong>only required</strong> information to run etcd inside vaquero, but you can also optionally specify <code>timeout</code> (for each request, in seconds, default=2) and <code>retry</code> (number of retries per request, default=3). The <code>10.10.10.5 - 10.10.10.7</code> Endpoints are what the vagrant VM reserves for servers (see &quot;Virtualenv Layout&quot; on this page), and the <code>2379</code> port is what we specified as our Etcd client endpoints on boot. If there is no Etcd information in your config, add it to the YAML.</p>
<pre><code>    Etcd:
      Endpoints:
      - &quot;http://10.10.10.5:2379&quot;
      - &quot;http://10.10.10.6:2379&quot;
      - &quot;http://10.10.10.7:2379&quot;
      Timeout: 5
      Retry: 3</code></pre>
<h3 id="d.-run-vaquero-from-the-container">d. Run vaquero from the container</h3>
<p>(this command uses <code>dir-sot.yaml</code>, replace with the config you used) <code>docker run -v /vagrant/config/dir-sot.yaml:/vaquero/config.yaml -v /var/vaquero/files:/var/vaquero/files -v /vagrant/local:/vagrant/local -v /vagrant/provision_files/secret:/vaquero/secret --net=&quot;host&quot; -e VAQUERO_SHARED_SECRET=&quot;&lt;secret&gt;&quot; -e VAQUERO_SERVER_SECRET=&quot;&lt;secret&gt;&quot; -e VAQUERO_SITE_ID=&quot;test-site&quot; shippedrepos-docker-vaquero.bintray.io/vaquero/vaquero:latest standalone --config /vaquero/config.yaml</code></p>
<h3 id="e.-finished">e. Finished!</h3>
<p>You should now see some etcd-related startup messages in the log output, including a successful Etcd PUT of the vagrant VM's local SOT. Success!</p>
<pre><code>    time=&quot;2016-12-15T21:46:28Z&quot; level=debug msg=&quot;Etcd client initialized at endpoints: [http://10.10.10.5:2379 http://10.10.10.6:2379 http://10.10.10.7:2379]&quot; package=storage
    time=&quot;2016-12-15T21:46:28Z&quot; level=info msg=&quot;Initialized etcd store for vaquero-local/test-site&quot; package=&quot;server/controller&quot;
    time=&quot;2016-12-15T21:46:28Z&quot; level=debug msg=&quot;Successful Etcd Get (withPrefix=false) for key model/current&quot; package=storage
    time=&quot;2016-12-15T21:46:28Z&quot; level=debug msg=&quot;Successful Etcd Put for key model/current&quot; package=storage</code></pre>
<h1 id="simulating-ipmi-reboots-in-the-virtual-environment">3. <a name="ipmi-reboots">simulating IPMI reboots in the virtual environment</a></h1>
<p>In a typical deployment, reprovisioning machines and multistage boots will kick off an IPMI container to force a restart. Since most VMs do not include an IPMI interface, we include the option of rebooting via SSH. <em>Note that vaquero injects public ssh keys into all booting hosts in the demos. Vaquero also bakes in the private ssh key into the vaquero agent. Vaquero leaves it to the operator to place ssh private keys onto agents, Vaquero does not provide ssh key management services and recommends to avoid placing ssh private keys in the data model.</em></p>
<ol style="list-style-type: decimal">
<li><p>Ensure the provisioned guest VM contains a public key for authorizing SSH login (see our example cloud-config scripts for an example).</p></li>
<li><p>Place the private key in a location accessible from vaquero agent with proper permissions (700).</p></li>
<li><p>Add a <code>bmc</code> entry to corresponding inventory entry. Set its type (ssh), the VM's username, and the location of the private key from <code>2.</code> See the <a href="https://ciscocloud.github.io/vaquero-docs/docs/current/data-model-howto.html">data model how-to</a> or the sample data model for more information.</p></li>
</ol>
<p>By default vaquero will not forcefully reprovision newly added machines. To make vaquero automatically reboot added hosts with <code>bmc</code> defined, set <code>force_provision: true</code> under <code>policy</code> in <code>env.yaml</code></p>
<h1 id="vaquero-demo-lab">4. <a name="vaquero-demo-lab">vaquero demo lab</a></h1>
<p>Vaquero provides this vagrant environment as a sandbox to work with vaquero before deployment. We provide 9 mac -&gt; IP mappings that are free for your use / testing, the machines labeled SANDBOX would be free. We also provide two example data models, one as a <a href="https://github.com/CiscoCloud/vaquero-examples/tree/vagrant">github</a> SoT and a local dir SoT, <a href="https://github.com/CiscoCloud/vaquero-vagrant/tree/master/local">vaquero-vagrant</a>. These define the demo machines and are a working data model to use as an example when you develop your own SoT.</p>
<h2 id="a.-virtual-env-layout">A. <a name="virtual-env-layout">virtual env layout</a></h2>
<h3 id="vagrant-vm-table">vagrant VM table</h3>
<p>There are <code>*</code>'s in the third space because VMs can be on the 10.10.10.0/24 or the 10.10.11.0/24 network. If no dhcp relay is in effect all machines will be on the 10.10.10.0/24 network, if dhcp relay is active, vaquero services will be moved to 10.10.11.0/24 while booting hosts will be on 10.10.10.10/24</p>
<table>
<thead>
<tr class="header">
<th align="left">Vagrant VM</th>
<th align="left">IP Address</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Relay gateway</td>
<td align="left">10.10.10.3 &amp; 10.10.11.3</td>
</tr>
<tr class="even">
<td align="left">Free</td>
<td align="left">10.10.*.4</td>
</tr>
<tr class="odd">
<td align="left">Vaquero server</td>
<td align="left">10.10.*.5 - 10.10.*.7</td>
</tr>
<tr class="even">
<td align="left">Vaquero agent</td>
<td align="left">10.10.*.8 - 10.10.*.10</td>
</tr>
</tbody>
</table>
<h3 id="booting-host-table">booting host table</h3>
<table>
<thead>
<tr class="header">
<th align="left">Mac address</th>
<th align="left">IP Address</th>
<th align="left">Demo</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">00:00:00:00:00:01</td>
<td align="left">10.10.10.11</td>
<td align="left">SANDBOX</td>
</tr>
<tr class="even">
<td align="left">00:00:00:00:00:02</td>
<td align="left">10.10.10.12</td>
<td align="left">SANDBOX</td>
</tr>
<tr class="odd">
<td align="left">00:00:00:00:00:03</td>
<td align="left">10.10.10.13</td>
<td align="left">SANDBOX</td>
</tr>
<tr class="even">
<td align="left">00:00:00:00:00:04</td>
<td align="left">10.10.10.14</td>
<td align="left">SANDBOX</td>
</tr>
<tr class="odd">
<td align="left">00:00:00:00:00:05</td>
<td align="left">10.10.10.15</td>
<td align="left">SANDBOX</td>
</tr>
<tr class="even">
<td align="left">00:00:00:00:00:06</td>
<td align="left">10.10.10.16</td>
<td align="left">SANDBOX</td>
</tr>
<tr class="odd">
<td align="left">00:00:00:00:00:07</td>
<td align="left">10.10.10.17</td>
<td align="left">SANDBOX</td>
</tr>
<tr class="even">
<td align="left">00:00:00:00:00:08</td>
<td align="left">10.10.10.18</td>
<td align="left">SANDBOX</td>
</tr>
<tr class="odd">
<td align="left">00:00:00:00:00:09</td>
<td align="left">10.10.10.19</td>
<td align="left">SANDBOX</td>
</tr>
<tr class="even">
<td align="left">00:00:00:00:00:21</td>
<td align="left">10.10.10.21</td>
<td align="left">core-cloud</td>
</tr>
<tr class="odd">
<td align="left">00:00:00:00:00:22</td>
<td align="left">10.10.10.22</td>
<td align="left">core-cloud</td>
</tr>
<tr class="even">
<td align="left">00:00:00:00:00:23</td>
<td align="left">10.10.10.23</td>
<td align="left">core-cloud</td>
</tr>
<tr class="odd">
<td align="left">00:00:00:00:00:24</td>
<td align="left">10.10.10.24</td>
<td align="left">core-cloud</td>
</tr>
<tr class="even">
<td align="left">00:00:00:00:00:31</td>
<td align="left">10.10.10.31</td>
<td align="left">core-ignition</td>
</tr>
<tr class="odd">
<td align="left">00:00:00:00:00:32</td>
<td align="left">10.10.10.32</td>
<td align="left">core-ignition</td>
</tr>
<tr class="even">
<td align="left">00:00:00:00:00:33</td>
<td align="left">10.10.10.33</td>
<td align="left">core-ignition</td>
</tr>
<tr class="odd">
<td align="left">00:00:00:00:00:34</td>
<td align="left">10.10.10.34</td>
<td align="left">core-ignition</td>
</tr>
<tr class="even">
<td align="left">00:00:00:00:00:41</td>
<td align="left">10.10.10.41</td>
<td align="left">centos</td>
</tr>
</tbody>
</table>
<h2 id="b.-canned-demos">B. <a name="canned-demos">canned demos</a></h2>
<p>This assumes there is a running vaquero instance as described above with either the provided github repo or local data model.</p>
<p><a href="https://cisco.box.com/s/lsohd9v7ik1rx1af3fthng1w87o9ig36">Video</a></p>
<ul>
<li><p>etcd cluster on Coreos via cloud-config: <code>./create_cluster/cluster.sh -d core-cloud</code></p></li>
<li><p>etcd cluster on Coreos via ignition: <code>./create_cluster/cluster.sh -d core-ignition</code></p></li>
<li><p>Centos7 base via kickstart: <code>./create_cluster/cluster.sh -d centos</code></p></li>
</ul>
<h2 id="c.-using-the-sandbox-mac-space">C. <a name="sandbox-mac-space">using the sandbox mac space</a></h2>
<h3 id="via-github">1. via github</h3>
<ol style="list-style-type: decimal">
<li>Go through steps 1-5.</li>
<li>You must add your personal git token into the <a href="https://github.com/CiscoCloud/vaquero-docs/tree/VagrantEnv/config">config</a> for this to work.</li>
<li>Create your own github repo to contain your own data model</li>
<li>If your machine is not routable set up <a href="README.html">ngrok and the githook as described in the README</a></li>
<li>Create your own vaquero configuration based off <code>config/git-sot.yaml</code> examples. Update the Gitter fields (URL) and SoT (branch) section to reflect your repo.</li>
<li>Start vaquero and ensure the zipball API info log refers to your repo and is a success</li>
<li>Update your github repo, see webhook</li>
<li>Run <code>./create-cluster/cluster -c &lt;count&gt;</code> to start <count> VM's starting at mac <code>:01</code> and counting up</li>
</ol>
<p><a href="https://cisco.box.com/s/b4d4d5v3i3yph4lvcoplydqny7p6qun4">Video</a></p>
<h3 id="via-local-dir">2.via local dir</h3>
<ol style="list-style-type: decimal">
<li>Go through steps 1-5</li>
<li>Update the <code>local/</code> data model.</li>
<li>Run <code>./create-cluster/cluster -c &lt;count&gt;</code> to start <count> VM's starting at mac <code>00:00:00:00:00:01</code> and counting up</li>
</ol>
<p><a href="https://cisco.box.com/s/cbvci60f1v6b3bcajq2ejtfizr3z0ss6">Video</a></p>
<h2 id="d.-running-the-validator-or-preview">D. <a href="tools.html">running the validator OR preview</a></h2>
<p>After [sshing] into the vagrant VM, with the container on it. Preview will work in the same way.</p>
<p>Validate on a local Data Model <code>docker run -v &lt;SRC_DIR&gt;:&lt;DEST_DIR&gt; shippedrepos-docker-vaquero.bintray.io/vaquero/vaquero:latest validate --sot &lt;DEST_DIR&gt;</code></p>
<h2 id="e.-kubernetes-in-the-virtualenv">E. <a name="kubernetes-in-the-virtualenv">kubernetes in the Virtualenv</a></h2>
<p>To start up the kubernetes cluster please log into each VS machine and run <code>sudo ./kube-start.sh</code>. This will start the kubernetes cluster across the VS nodes. Regardless of how many VS machines you deploy, <code>vs-1</code> will always be the Kube master and <code>vs-1</code>, <code>vs-2</code> and <code>vs-3</code> will be listed as kubernetes nodes. You must run <code>sudo ./kube-start.sh</code> on every vs machine to successfully standup the kubernetes cluster.</p>
